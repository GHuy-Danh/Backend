<div class="content">
    <div class="welcome-card">
        <h2>üéì Danh s√°ch sinh vi√™n ph·ª• tr√°ch</h2>
        <p>Hi·ªÉn th·ªã danh s√°ch sinh vi√™n thu·ªôc l·ªõp c·ªë v·∫•n h·ªçc t·∫≠p / l·ªõp h·ªçc ph·∫ßn b·∫°n ƒëang qu·∫£n l√Ω.</p>
    </div>

    <div class="info-card filter-card">
        <h3>T√¨m ki·∫øm & L·ªçc</h3>
        <div class="filter-controls">
            <input 
                type="text" 
                placeholder="üîç T√¨m theo t√™n ho·∫∑c MSSV..." 
                [(ngModel)]="searchQuery"
                (keyup.enter)="onSearchClick()"
                (change)="onSearchChange()"
            />
            <select 
                [ngModel]="selectedClass" 
                (ngModelChange)="onClassChange($event)"
            >
                <option *ngFor="let lop of classOptions" [value]="lop">{{ lop }}</option>
            </select>
            <button class="btn search-btn" (click)="onSearchClick()">T√¨m ki·∫øm</button>
        </div>
    </div>

    <div class="info-card">
        <h3>
            Danh s√°ch sinh vi√™n 
            <span *ngIf="!isLoading">({{ filteredStudents.length }} / {{ allStudents.length }} SV)</span>
        </h3>

        <div *ngIf="isLoading" class="loading-message">
            <div class="spinner"></div> ƒêang t·∫£i danh s√°ch sinh vi√™n...
        </div>
        
        <div *ngIf="errorMessage" class="error-message">
            {{ errorMessage }}
        </div>
        
        <div *ngIf="!isLoading && !errorMessage && filteredStudents.length === 0" class="alert-warning">
            Kh√¥ng t√¨m th·∫•y sinh vi√™n n√†o theo ƒëi·ªÅu ki·ªán l·ªçc.
        </div>

        <div class="table-scroll" *ngIf="!isLoading && filteredStudents.length > 0">
            <table>
                <thead>
                    <tr>
                        <th style="width: 5%;">STT</th>
                        <th style="width: 15%;">MSSV</th>
                        <th style="width: 25%;">H·ªç t√™n</th>
                        <th style="width: 15%;">L·ªõp</th>
                        <th style="width: 20%;">Ng√†nh</th>
                        <th style="width: 10%;">Tr·∫°ng th√°i</th>
                        <th style="width: 10%;">Thao t√°c</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let student of filteredStudents; let i = index">
                        <td>{{ i + 1 }}</td>
                        <td>{{ student.ma_sv }}</td>
                        <td>{{ student.ho_ten }}</td>
                        <td>{{ student.lop }}</td>
                        <td>{{ student.nganh }}</td>
                        <td>
                            <span 
                                class="status"
                                [ngClass]="{
                                    'success': student.trang_thai_hoc_tap === 'ƒêang h·ªçc',
                                    'warning': student.trang_thai_hoc_tap === 'B·∫£o l∆∞u',
                                    'danger': student.trang_thai_hoc_tap === 'C·∫£nh c√°o h·ªçc v·ª•'
                                }"
                            >
                                {{ student.trang_thai_hoc_tap }}
                            </span>
                        </td>
                        <td>
                            <button class="btn-view" (click)="viewStudentDetail(student)">Xem</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <!-- ============================== -->
    <!-- MODAL: Chi ti·∫øt Sinh Vi√™n      -->
    <!-- ============================== -->
    <div class="modal-backdrop" *ngIf="showStudentModal" (click)="closeModal()"></div>
    
    <div class="modal" [class.open]="showStudentModal">
        <div class="modal-content">
            <h3>Th√¥ng tin chi ti·∫øt sinh vi√™n</h3>
            
            <div *ngIf="selectedStudent">
                <div class="detail-row">
                    <label>M√£ s·ªë sinh vi√™n:</label>
                    <span>{{ selectedStudent.ma_sv }}</span>
                </div>
                <div class="detail-row">
                    <label>H·ªç v√† T√™n:</label>
                    <span style="font-weight: 700; color: #1565c0;">{{ selectedStudent.ho_ten }}</span>
                </div>
                <div class="detail-row">
                    <label>L·ªõp h√†nh ch√≠nh:</label>
                    <span>{{ selectedStudent.lop }}</span>
                </div>
                <div class="detail-row">
                    <label>Chuy√™n ng√†nh:</label>
                    <span>{{ selectedStudent.nganh }}</span>
                </div>
                <div class="detail-row">
                    <label>Ng√†y sinh:</label>
                    <span>{{ selectedStudent.ngay_sinh | date: 'dd/MM/yyyy' }}</span>
                </div>
                <div class="detail-row">
                    <label>Email:</label>
                    <span>{{ selectedStudent.email }}</span>
                </div>
                <div class="detail-row">
                    <label>Tr·∫°ng th√°i h·ªçc t·∫≠p:</label>
                    <span class="status"
                        [ngClass]="{
                            'success': selectedStudent.trang_thai_hoc_tap === 'ƒêang h·ªçc',
                            'warning': selectedStudent.trang_thai_hoc_tap === 'B·∫£o l∆∞u',
                            'danger': selectedStudent.trang_thai_hoc_tap === 'C·∫£nh c√°o h·ªçc v·ª•'
                        }">
                        {{ selectedStudent.trang_thai_hoc_tap }}
                    </span>
                </div>
            </div>

            <div class="modal-actions">
                <button class="cancel-btn" (click)="closeModal()">ƒê√≥ng</button>
            </div>
        </div>
    </div>
</div>