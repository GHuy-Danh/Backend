<div class="content">
  <div class="info-card toolbar">
    <h3>Qu·∫£n l√Ω Ng∆∞·ªùi d√πng</h3>
    <div class="toolbar-actions">
      <button class="btn add-btn" (click)="openAddModal()">Th√™m Ng∆∞·ªùi d√πng</button>
      <button class="btn add-btn purple-btn" (click)="openResetPasswordModal()">Reset m·∫≠t kh·∫©u</button>
    </div>
  </div>

  <!-- SEARCH + FILTER -->
  <div class="info-card filter-box">
    <input
      class="search-input"
      placeholder="üîç T√¨m ki·∫øm theo ID / H·ªç t√™n / Email..."
      [(ngModel)]="searchKey"
      (input)="applyFilter()"
    />

    <select class="filter-select" [(ngModel)]="filterLoai" (change)="applyFilter()">
      <option value="T·∫•t c·∫£">T·∫•t c·∫£ lo·∫°i t√†i kho·∫£n</option>
      <option value="Sinh vi√™n">Sinh vi√™n</option>
      <option value="Gi·∫£ng vi√™n">Gi·∫£ng vi√™n</option>
      <option value="Qu·∫£n tr·ªã vi√™n">Qu·∫£n tr·ªã vi√™n</option>
    </select>
  </div>

  <div class="info-card">
    <h3>Danh s√°ch Ng∆∞·ªùi d√πng</h3>

    <div *ngIf="isLoading" class="alert alert-info">ƒêang t·∫£i danh s√°ch...</div>
    <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

    <table class="subject-table" *ngIf="!isLoading && !errorMessage">
      <thead>
        <tr>
          <th>M√£</th>
          <th>H·ªç t√™n</th>
          <th>Email</th>
          <th>Lo·∫°i</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let u of paginatedUsers">
          <td>{{ u._id }}</td>
          <td>{{ u.ho_ten }}</td>
          <td>{{ u.email }}</td>
          <td>{{ u.loai }}</td>
          <td>
            <button class="btn edit" (click)="openEditModal(u)">‚úèÔ∏è</button>
            <button class="btn delete" (click)="deleteUser(u._id)">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- PAGINATION -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button class="page-btn" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">
        ‚óÄ Tr∆∞·ªõc
      </button>

      <span>Trang {{ currentPage }} / {{ totalPages }}</span>

      <button class="page-btn" (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">
        Sau ‚ñ∂
      </button>
    </div>
  </div>
</div>

<!-- ===========================
     ADD MODAL 
     =========================== -->
<div class="modal-backdrop" *ngIf="isAddModalOpen" (click)="closeAddModal()"></div>
<div class="modal" [class.open]="isAddModalOpen">
  <div class="modal-content">
    <h3>Th√™m Ng∆∞·ªùi d√πng m·ªõi</h3>

    <form (ngSubmit)="submitAddForm()">

      <div class="form-group">
        <label>M√£ ng∆∞·ªùi d√πng</label>
        <input [(ngModel)]="addFormModel._id" name="add_id" placeholder="Nh·∫≠p m√£ (VD: SV2024001)" required />
      </div>

      <div class="form-group">
        <label>H·ªç t√™n</label>
        <input [(ngModel)]="addFormModel.ho_ten" name="add_name" placeholder="Nh·∫≠p h·ªç v√† t√™n" required />
      </div>

      <div class="form-group">
        <label>Email</label>
        <input [(ngModel)]="addFormModel.email" name="add_email" placeholder="Nh·∫≠p email" required />
      </div>

      <div class="form-group">
        <label>M·∫≠t kh·∫©u</label>
        <input [(ngModel)]="addFormModel.mat_khau" name="add_pw" placeholder="Nh·∫≠p m·∫≠t kh·∫©u" required />
      </div>

      <div class="form-group">
        <label>Lo·∫°i t√†i kho·∫£n</label>
        <select [(ngModel)]="addFormModel.loai" name="add_loai" required>
          <option value="" disabled selected>-- Ch·ªçn lo·∫°i t√†i kho·∫£n --</option>
          <option value="Sinh vi√™n">Sinh vi√™n</option>
          <option value="Gi·∫£ng vi√™n">Gi·∫£ng vi√™n</option>
          <option value="Qu·∫£n tr·ªã vi√™n">Qu·∫£n tr·ªã vi√™n</option>
        </select>
      </div>

      <div class="modal-actions">
        <button type="button" class="cancel-btn" (click)="closeAddModal()">H·ªßy</button>
        <button class="btn add-btn" type="submit">Th√™m</button>
      </div>

    </form>
  </div>
</div>


<!-- ===========================
     EDIT MODAL
     =========================== -->
<div class="modal-backdrop" *ngIf="isEditModalOpen" (click)="closeEditModal()"></div>
<div class="modal" [class.open]="isEditModalOpen">
  <div class="modal-content">
    <h3>C·∫≠p nh·∫≠t Ng∆∞·ªùi d√πng</h3>

    <form (ngSubmit)="submitEditForm()">

      <div class="form-group">
        <label>M√£ ng∆∞·ªùi d√πng:</label>
        <input [value]="editFormModel._id" disabled />
      </div>

      <div class="form-group">
        <label>H·ªç t√™n: <span class="old-value">{{ editOldUser?.ho_ten }}</span></label>
        <input [(ngModel)]="editFormModel.ho_ten" name="edit_name" placeholder="Nh·∫≠p h·ªç t√™n m·ªõi" />
      </div>

      <div class="form-group">
        <label>Email: <span class="old-value">{{ editOldUser?.email }}</span></label>
        <input [(ngModel)]="editFormModel.email" name="edit_email" placeholder="Nh·∫≠p email m·ªõi" />
      </div>

      <div class="form-group">
        <label>Lo·∫°i t√†i kho·∫£n: <span class="old-value">{{ editOldUser?.loai }}</span></label>
        <!-- <select [(ngModel)]="editFormModel.loai" name="edit_loai">
          <option value="">-- Ch·ªçn lo·∫°i m·ªõi --</option>
          <option value="Sinh vi√™n">Sinh vi√™n</option>
          <option value="Gi·∫£ng vi√™n">Gi·∫£ng vi√™n</option>
          <option value="Qu·∫£n tr·ªã vi√™n">Qu·∫£n tr·ªã vi√™n</option>
        </select> -->
      </div>

      <div class="modal-actions">
        <button type="button" class="cancel-btn" (click)="closeEditModal()">H·ªßy</button>
        <button class="btn add-btn" type="submit">L∆∞u</button>
      </div>
    </form>
  </div>
</div>


<!-- ===========================
     RESET PASSWORD MODAL 
     =========================== -->
<div class="modal-backdrop" *ngIf="isResetPwModalOpen" (click)="closeResetPwModal()"></div>
<div class="modal" [class.open]="isResetPwModalOpen">
  <div class="modal-content">
    <h3>Reset m·∫≠t kh·∫©u</h3>

    <!-- Search ID -->
    <div class="form-row">
      <input [(ngModel)]="resetTargetId" placeholder="Nh·∫≠p ID ng∆∞·ªùi d√πng" />
      <button class="btn add-btn" style="background:#0288d1" (click)="findUserForReset()">T√¨m</button>
    </div>

    <!-- Info + Reset -->
    <div *ngIf="resetTargetUser" class="reset-info">
      <p><strong>H·ªç t√™n:</strong> {{ resetTargetUser.ho_ten }}</p>
      <p><strong>Email:</strong> {{ resetTargetUser.email }}</p>
      <p><strong>Lo·∫°i t√†i kho·∫£n:</strong> {{ resetTargetUser.loai }}</p>

      <div class="modal-actions">
        <button class="cancel-btn" (click)="closeResetPwModal()">H·ªßy</button>
        <button class="btn add-btn" (click)="resetPasswordNow()">Reset v·ªÅ ‚Äú123‚Äù</button>
      </div>
    </div>

  </div>
</div>

