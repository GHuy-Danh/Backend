<div class="content">
  <div class="info-card toolbar">
    <h3>Qu·∫£n l√Ω M√¥n h·ªçc</h3>
    <button class="btn add-btn" (click)="openAddModal()">Th√™m M√¥n h·ªçc</button>
  </div>

  <div class="info-card filter-box">
  <input class="search-input" placeholder="üîç T√¨m ki·∫øm theo M√£ / T√™n..." [(ngModel)]="searchKey" (input)="applyFilter()" />

  <select class="filter-select" [(ngModel)]="filterKhoi" (change)="applyFilter()">
    <option value="">T·∫•t c·∫£ kh·ªëi</option>
    <option value="C∆° s·ªü ng√†nh">C∆° s·ªü ng√†nh</option>
    <option value="Chuy√™n ng√†nh">Chuy√™n ng√†nh</option>
  </select>

  <select class="filter-select" [(ngModel)]="filterLoai" (change)="applyFilter()">
    <option value="">T·∫•t c·∫£ lo·∫°i</option>
    <option value="B·∫Øt bu·ªôc">B·∫Øt bu·ªôc</option>
    <option value="T·ª± ch·ªçn">T·ª± ch·ªçn</option>
  </select>
</div>


  <div class="info-card">
    <h3>Danh s√°ch M√¥n h·ªçc</h3>

    <div *ngIf="isLoading" class="alert alert-info">ƒêang t·∫£i d·ªØ li·ªáu...</div>
    <div *ngIf="errorMessage" class="alert alert-danger">{{ errorMessage }}</div>

    <table class="subject-table" *ngIf="!isLoading && !errorMessage">
      <thead>
        <tr>
          <th>M√£ HP</th>
          <th>T√™n h·ªçc ph·∫ßn</th>
          <th>Kh·ªëi</th>
          <th>Lo·∫°i</th>
          <th>H·ªçc k·ª≥</th>
          <th>T√≠n ch·ªâ</th>
          <th>Ph·∫°m vi</th>
          <th>M√£ CN</th>
          <th>ƒêi·ªÅu ki·ªán</th>
          <th>Thao t√°c</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let s of paginatedSubjects">
          <td>{{ s.ma_hoc_phan }}</td>
          <td>{{ s.ten_hoc_phan }}</td>
          <td>{{ s.khoi }}</td>
          <td>{{ s.loai }}</td>
          <td>{{ s.hoc_ky }}</td>
          <td>{{ s.so_tin_chi }}</td>
          <td>{{ s.pham_vi }}</td>
          <td>{{ s.ma_chuyen_nganh }}</td>
          <td>{{ formatDieuKien(s.dieu_kien) }}</td>
          <td>
            <button class="btn edit" (click)="openEditModal(s)">‚úèÔ∏è</button>
            <button class="btn delete" (click)="deleteSubject(s.ma_hoc_phan)">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- üîπ Ph√¢n trang -->
    <div class="pagination" *ngIf="totalPages > 1">
      <button class="btn page-btn" (click)="changePage(currentPage - 1)" [disabled]="currentPage === 1">
        ‚óÄ Tr∆∞·ªõc
      </button>
      <span>Trang {{ currentPage }} / {{ totalPages }}</span>
      <button class="btn page-btn" (click)="changePage(currentPage + 1)" [disabled]="currentPage === totalPages">
        Sau ‚ñ∂
      </button>
    </div>

  </div>
</div>

<!-- MODAL TH√äM -->
<div class="modal-backdrop" *ngIf="isAddModalOpen" (click)="closeAddModal()"></div>
<div class="modal" [class.open]="isAddModalOpen">
  <div class="modal-content">
    <h3>Th√™m M√¥n h·ªçc m·ªõi</h3>
    <form (ngSubmit)="submitAddForm()">

      <!-- M√£ v√† t√™n h·ªçc ph·∫ßn -->
      <div class="form-row">
        <div class="form-group">
          <label>M√£ h·ªçc ph·∫ßn</label>
          <input [(ngModel)]="addFormModel.ma_hoc_phan" name="ma_hoc_phan" placeholder="VD: INT101" required />
        </div>
        <div class="form-group">
          <label>T√™n h·ªçc ph·∫ßn</label>
          <input [(ngModel)]="addFormModel.ten_hoc_phan" name="ten_hoc_phan" placeholder="Nh·∫≠p t√™n h·ªçc ph·∫ßn" required />
        </div>
      </div>

      <!-- Kh·ªëi v√† lo·∫°i -->
      <div class="form-row">
        <div class="form-group">
          <label>Kh·ªëi</label>
          <select [(ngModel)]="addFormModel.khoi" name="khoi" required>
            <option value="">Ch·ªçn kh·ªëi</option>
            <option value="C∆° s·ªü ng√†nh">C∆° s·ªü ng√†nh</option>
            <option value="Chuy√™n ng√†nh">Chuy√™n ng√†nh</option>
            <option value="ƒê·∫°i c∆∞∆°ng">ƒê·∫°i c∆∞∆°ng</option>
          </select>
        </div>
        <div class="form-group">
          <label>Lo·∫°i</label>
          <select [(ngModel)]="addFormModel.loai" name="loai" required>
            <option value="">Ch·ªçn lo·∫°i</option>
            <option value="B·∫Øt bu·ªôc">B·∫Øt bu·ªôc</option>
            <option value="T·ª± ch·ªçn">T·ª± ch·ªçn</option>
          </select>
        </div>
      </div>

      <!-- H·ªçc k·ª≥ v√† t√≠n ch·ªâ -->
      <div class="form-row">
        <div class="form-group">
          <label>H·ªçc k·ª≥</label>
          <input [(ngModel)]="addFormModel.hoc_ky" name="hoc_ky" type="number" placeholder="H·ªçc k·ª≥" required />
        </div>
        <div class="form-group">
          <label>T√≠n ch·ªâ</label>
          <input [(ngModel)]="addFormModel.so_tin_chi" name="so_tin_chi" type="number" placeholder="T√≠n ch·ªâ" required />
        </div>
      </div>

      <!-- Ph·∫°m vi v√† chuy√™n ng√†nh -->
      <div class="form-row">
        <div class="form-group">
          <label>Ph·∫°m vi</label>
          <input [(ngModel)]="addFormModel.pham_vi" name="pham_vi" placeholder="VD: Chung, CN..." />
        </div>
        <div class="form-group">
          <label>M√£ chuy√™n ng√†nh</label>
          <input [(ngModel)]="addFormModel.ma_chuyen_nganh" name="ma_chuyen_nganh" placeholder="ALL / CNPM..." />
        </div>
      </div>

      <!-- ƒêi·ªÅu ki·ªán: h·ªçc tr∆∞·ªõc v√† ti√™n quy·∫øt -->
      <div class="form-row">
        <div class="form-group">
          <label>H·ªçc tr∆∞·ªõc</label>
          <input [(ngModel)]="addFormModel.dieu_kien_hoc_truoc" name="dieu_kien_hoc_truoc" placeholder="VD: INT100" />
        </div>
        <div class="form-group">
          <label>Ti√™n quy·∫øt</label>
          <input [(ngModel)]="addFormModel.dieu_kien_tien_quyet" name="dieu_kien_tien_quyet" placeholder="VD: INT105" />
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn cancel-btn" (click)="closeAddModal()">H·ªßy</button>
        <button class="btn add-btn" type="submit">Th√™m</button>
      </div>
    </form>
  </div>
</div>

<!-- MODAL S·ª¨A -->
<div class="modal-backdrop" *ngIf="isEditModalOpen" (click)="closeEditModal()"></div>
<div class="modal" [class.open]="isEditModalOpen">
  <div class="modal-content">
    <h3>C·∫≠p nh·∫≠t m√¥n h·ªçc</h3>
    <form (ngSubmit)="submitEditForm()">

      <!-- M√£ v√† t√™n h·ªçc ph·∫ßn -->
      <div class="form-row">
        <div class="form-group">
          <label>M√£ h·ªçc ph·∫ßn:</label>
          <input [(ngModel)]="editFormModel.ma_hoc_phan" name="edit_ma_hoc_phan" disabled />
        </div>
        <div class="form-group">
          <label>T√™n h·ªçc ph·∫ßn: <span class="old-value">{{ editOldSubject?.ten_hoc_phan }}</span></label>
          <input [(ngModel)]="editFormModel.ten_hoc_phan" name="edit_ten_hoc_phan" placeholder="T√™n h·ªçc ph·∫ßn m·ªõi" />
        </div>
      </div>

      <!-- Kh·ªëi v√† lo·∫°i -->
      <div class="form-row">
        <div class="form-group">
          <label>Kh·ªëi: <span class="old-value">{{ editOldSubject?.khoi }}</span></label>
          <select [(ngModel)]="editFormModel.khoi" name="edit_khoi">
            <option value="">-- Ch·ªçn kh·ªëi --</option>
            <option value="C∆° s·ªü ng√†nh">C∆° s·ªü ng√†nh</option>
            <option value="Chuy√™n ng√†nh">Chuy√™n ng√†nh</option>
            <option value="ƒê·∫°i c∆∞∆°ng">ƒê·∫°i c∆∞∆°ng</option>
          </select>
        </div>
        <div class="form-group">
          <label>Lo·∫°i: <span class="old-value">{{ editOldSubject?.loai }}</span></label>
          <select [(ngModel)]="editFormModel.loai" name="edit_loai">
            <option value="">-- Ch·ªçn lo·∫°i --</option>
            <option value="B·∫Øt bu·ªôc">B·∫Øt bu·ªôc</option>
            <option value="T·ª± ch·ªçn">T·ª± ch·ªçn</option>
          </select>
        </div>
      </div>

      <!-- H·ªçc k·ª≥ v√† t√≠n ch·ªâ -->
      <div class="form-row">
        <div class="form-group">
          <label>H·ªçc k·ª≥: <span class="old-value">{{ editOldSubject?.hoc_ky }}</span></label>
          <input [(ngModel)]="editFormModel.hoc_ky" name="edit_hoc_ky" type="number" placeholder="H·ªçc k·ª≥ m·ªõi" />
        </div>
        <div class="form-group">
          <label>T√≠n ch·ªâ: <span class="old-value">{{ editOldSubject?.so_tin_chi }}</span></label>
          <input [(ngModel)]="editFormModel.so_tin_chi" name="edit_so_tin_chi" type="number" placeholder="T√≠n ch·ªâ m·ªõi" />
        </div>
      </div>

      <!-- Ph·∫°m vi v√† chuy√™n ng√†nh -->
      <div class="form-row">
        <div class="form-group">
          <label>Ph·∫°m vi: <span class="old-value">{{ editOldSubject?.pham_vi }}</span></label>
          <input [(ngModel)]="editFormModel.pham_vi" name="edit_pham_vi" placeholder="Ph·∫°m vi m·ªõi" />
        </div>
        <div class="form-group">
          <label>M√£ chuy√™n ng√†nh: <span class="old-value">{{ editOldSubject?.ma_chuyen_nganh }}</span></label>
          <input [(ngModel)]="editFormModel.ma_chuyen_nganh" name="edit_ma_chuyen_nganh" placeholder="M√£ chuy√™n ng√†nh m·ªõi" />
        </div>
      </div>

      <!-- ƒêi·ªÅu ki·ªán -->
      <div class="form-row">
        <div class="form-group">
          <label>H·ªçc tr∆∞·ªõc: <span class="old-value">{{ editOldSubject?.dieu_kien?.hoc_truoc }}</span></label>
          <input [(ngModel)]="editFormModel.dieu_kien_hoc_truoc" name="edit_dieu_kien_hoc_truoc" placeholder="H·ªçc tr∆∞·ªõc m·ªõi" />
        </div>
        <div class="form-group">
          <label>Ti√™n quy·∫øt: <span class="old-value">{{ editOldSubject?.dieu_kien?.tien_quyet }}</span></label>
          <input [(ngModel)]="editFormModel.dieu_kien_tien_quyet" name="edit_dieu_kien_tien_quyet" placeholder="Ti√™n quy·∫øt m·ªõi" />
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" class="btn cancel-btn" (click)="closeEditModal()">H·ªßy</button>
        <button class="btn add-btn" type="submit">L∆∞u</button>
      </div>
    </form>
  </div>
</div>

