<div class="content">
  <!-- TOOLBAR -->
  <div class="info-card toolbar">
    <h3>Th·ªëng k√™ & B√°o c√°o</h3>
    <div class="toolbar-actions">
      <select class="filter-select" [(ngModel)]="selectedHocKy" (change)="onHocKyChange()">
        <option [value]="1">H·ªçc k·ª≥ 1</option>
        <option [value]="2">H·ªçc k·ª≥ 2</option>
        <option [value]="3">H·ªçc k·ª≥ 3</option>
        <option [value]="4">H·ªçc k·ª≥ 4</option>
        <option [value]="5">H·ªçc k·ª≥ 5</option>
        <option [value]="6">H·ªçc k·ª≥ 6</option>
        <option [value]="7">H·ªçc k·ª≥ 7</option>
        <option [value]="8">H·ªçc k·ª≥ 8</option>
      </select>
      
      <button class="btn export-btn" (click)="exportExcel()">
        Xu·∫•t B√°o C√°o (Excel)
      </button>
    </div>
  </div>

  <!-- DASHBOARD CARDS -->
  <div class="stats-grid">
    <div class="stat-card blue">
      <div class="icon">üéì</div>
      <div class="info">
        <span class="label">T·ªïng l∆∞·ª£t ƒëƒÉng k√Ω</span>
        <span class="value">{{ stats.tong_luot_dang_ky }}</span>
      </div>
    </div>

    <div class="stat-card purple">
      <div class="icon">üìö</div>
      <div class="info">
        <span class="label">T·ªïng s·ªë l·ªõp</span>
        <span class="value">{{ stats.tong_so_lop }}</span>
      </div>
    </div>

    <div class="stat-card green">
      <div class="icon">‚úÖ</div>
      <div class="info">
        <span class="label">L·ªõp ƒë∆∞·ª£c m·ªü</span>
        <span class="value">{{ stats.lop_duoc_mo }}</span>
      </div>
    </div>

    <div class="stat-card red">
      <div class="icon">‚ö†Ô∏è</div>
      <div class="info">
        <span class="label">L·ªõp s·∫Ω h·ªßy</span>
        <span class="value">{{ stats.lop_se_huy }}</span>
      </div>
    </div>
  </div>

  <div class="charts-container">
    <!-- B·∫¢NG CHI TI·∫æT -->
    <div class="info-card main-table">
      <h3>Chi ti·∫øt Tr·∫°ng th√°i L·ªõp h·ªçc ph·∫ßn</h3>
      <div *ngIf="isLoading" style="padding:20px; text-align:center">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu...</div>
      
      <div class="table-scroll" *ngIf="!isLoading">
        <table>
          <thead>
            <tr>
              <th>M√£ LHP</th>
              <th>T√™n h·ªçc ph·∫ßn</th>
              <th>Sƒ© s·ªë</th>
              <th>T·ªëi thi·ªÉu</th>
              <th>Tr·∫°ng th√°i</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let lop of stats.chi_tiet">
              <td>{{ lop.ma_lop_hp }}</td>
              <td>{{ lop.ten_hoc_phan }}</td>
              <td>
                <div class="progress-wrapper">
                  <span>{{ lop.si_so }}/{{ lop.toi_da }}</span>
                  <div class="progress-bar">
                    <div class="fill" 
                         [style.width.%]="(lop.si_so / lop.toi_da) * 100"
                         [style.background-color]="lop.trang_thai === 'ƒê∆∞·ª£c m·ªü' ? '#4caf50' : '#f44336'">
                    </div>
                  </div>
                </div>
              </td>
              <td>{{ lop.toi_thieu }}</td>
              <td>
                <span [class]="'badge ' + (lop.trang_thai === 'ƒê∆∞·ª£c m·ªü' ? 'success' : 'danger')">
                  {{ lop.trang_thai }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- TOP M√îN H·ªåC (B·∫£ng nh·ªè b√™n ph·∫£i) -->
    <div class="info-card side-table">
      <h3>üî• Top M√¥n ƒêƒÉng K√Ω Nhi·ªÅu</h3>
      <ul class="top-list">
        <li *ngFor="let sub of topSubjects; let i = index">
          <span class="rank">{{ i + 1 }}</span>
          <div class="sub-info">
            <strong>{{ sub.ten_hoc_phan }}</strong>
            <small>{{ sub.ma_hoc_phan }}</small>
          </div>
          <span class="count">{{ sub.so_luong }} SV</span>
        </li>
      </ul>
    </div>
  </div>
</div>